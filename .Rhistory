#| label: filter
db_long <- db_long %>% filter(consent == 1) %>% select(-consent)
# Chunk 6: recode and transform
#| label: recode and transform
# level
frq(db_long$curse_level)
db_long <- db_long %>%
mutate(
cohort_level = if_else(curse_level %in% c("6to", "7mo"), "Básica", "Media"),
cohort_level = factor(cohort_level,
labels = c("Básica", "Media")),
curse_level = factor(curse_level,
levels = c("6to", "7mo", "1ro", "2do"))
)
# merit-scale society
frq(db_long$perc_effort)
frq(db_long$perc_talent)
frq(db_long$perc_rich_parents)
frq(db_long$perc_contact)
frq(db_long$pref_effort)
frq(db_long$pref_talent)
frq(db_long$pref_rich_parents)
frq(db_long$pref_contact)
labels1 <- c("Muy en desacuerdo" = 1,
"En desacuerdo" = 2,
"De acuerdo" = 3,
"Muy de acuerdo" = 4,
"No sabe" = 88,
"No responde" = 99)
db_long <- db_long %>%
mutate_at(.vars = (4:11),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (4:11),.funs = ~ set_na(., na = c(88,99)))
# merit school
frq(db_long$school_effort)
frq(db_long$school_talent)
db_long <- db_long %>%
mutate_at(.vars = (12:13),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (12:13),.funs = ~ set_na(., na = c(88,99)))
# percep inequality
frq(db_long$inequality)
db_long <- db_long %>%
mutate(inequality = sjlabelled::set_labels(inequality, labels = labels1),
inequality = set_na(inequality, na = c(88,99)))
# market justice preference
frq(db_long$just_educ)
frq(db_long$just_health)
frq(db_long$just_pension)
db_long <- db_long %>%
mutate_at(.vars = (15:17),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (15:17),.funs = ~ set_na(., na = c(88,99)))
db_long$mjp <- rowMeans(x = db_long[15:17], na.rm = T)
db_long$mjp <- if_else(is.nan(db_long$mjp), NA, db_long$mjp)
summary(db_long$mjp)
# gender
frq(db_long$gender)
db_long$gender <- car::recode(db_long$gender,
recodes = c("'H'= 'Hombre'; 'M' = 'Mujer'; 'O' = 'Otro'"),
as.factor = T)
# age
frq(db_long$age)
db_long$age <- 2024 - db_long$age
db_long$age2 <- db_long$age^2
# ses
frq(db_long$books)
db_long <- db_long %>%
mutate(books = case_when(books <= 2 ~ "Menos de 25",
books >= 3 & books <= 6 ~ "Más de 25",
TRUE ~ NA_character_),
books = factor(books, levels = c("Menos de 25", "Más de 25")))
db_long <- left_join(
db_long,
db_parents[,c("id_estudiante_apoderado", "id_apoderado", "p12_1_apoderado")],
by = c("id_estudiante" = "id_estudiante_apoderado")
)
frq(db_long$p12_1_apoderado)
frq(db_long$educ_m)
frq(db_long$educ_p)
db_long <- db_long %>%
mutate(
across(
.cols = c(educ_m, educ_p, p12_1_apoderado),
.fns = ~ set_na(., na = c(88,99))
)
)
db_long <- db_long %>%
rowwise() %>%
mutate(
aux1 = case_when(
!is.na(educ_p) & !is.na(educ_m) ~ max(educ_p, educ_m),
is.na(educ_p)   & !is.na(educ_m) ~ educ_m,
!is.na(educ_p)  &  is.na(educ_m) ~ educ_p,
TRUE                                  ~ NA_real_
)
) %>%
ungroup()
frq(db_long$aux1)
frq(db_long$p12_1_apoderado)
db_long <- db_long %>%
group_by(id_estudiante) %>%
rowwise() %>%
mutate(parental_educ = if_else(is.na(p12_1_apoderado), aux1, p12_1_apoderado)) %>%
ungroup()
frq(db_long$parental_educ)
db_long <- db_long %>%
rowwise() %>%
mutate(parental_educ = case_when(parental_educ == 1 ~ "Primaria o menos",
parental_educ == 2 ~ "Primaria o menos",
parental_educ == 3 ~ "Primaria o menos",
parental_educ == 4 ~ "Secundaria",
parental_educ == 5 ~ "Secundaria",
parental_educ == 6 ~ "Superior técnica",
parental_educ == 7 ~ "Superior técnica",
parental_educ == 8 ~ "Universitaria o Posgrado",
parental_educ == 9 ~ "Universitaria o Posgrado",
parental_educ == 10 ~ "Universitaria o Posgrado",
is.na(parental_educ) ~ "Valor perdido")) %>%
ungroup()
db_long$parental_educ <- factor(db_long$parental_educ, levels = c("Primaria o menos", "Secundaria", "Superior técnica", "Universitaria o Posgrado", "Valor perdido"))
# Chunk 7: etiquetas
#| label: etiquetas
db_long$curse_level <- set_label(db_long$curse_level,label = "Curso estudiante")
db_long$cohort_level <- set_label(db_long$cohort_level,label = "Cohorte estudiante")
db_long$gender <- set_label(db_long$gender,label = "Género")
db_long$age <- set_label(db_long$age,label = "Edad")
db_long$age2 <- set_label(db_long$age2,label = "Edad^2")
db_long$books <- set_label(db_long$books,label = "Libros en el hogar")
db_long$mjp <- set_label(db_long$mjp,label = "Justicia de mercado")
db_long$parental_educ <- set_label(db_long$parental_educ,label = "Nivel educacional parental")
db_proc <- db_long %>%
select(-c(educ_m, educ_p, aux1, p12_1_apoderado, id_apoderado))
# Chunk 8: missings
#| label: missings
colSums(is.na(db_proc))
n_miss(db_proc)
prop_miss(db_proc)*100
miss_var_summary(db_proc)
vis_miss(db_proc) + theme(axis.text.x = element_text(angle=80))
# Chunk 9
print(summarytools::dfSummary(db_proc), method="render")
save(db_long, file = here("output/data/db_proc.RData"))
save(db_long, file = here("output/data/db_proc.RData"))
save(db_proc, file = here("output/data/db_proc.RData"))
# Chunk 1: set
#| label: set
#| echo: false
#| message: false
#| warning: false
library(knitr)
knitr::opts_chunk$set(echo = TRUE, include = TRUE, warning = FALSE, message = FALSE)
table_format <- if(is_html_output()) {
"html"
} else if(is_latex_output()) {
"latex"
}
table_format2 <- if(is_html_output()) {
T
} else if(is_latex_output()) {
F
}
options(kableExtra.html.bsTable = T)
options(knitr.kable.NA = "")
# Chunk 2: libraries
#| label: libraries
if (! require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse,
sjmisc,
here,
sjlabelled,
naniar,
car,
kableExtra,
summarytools)
options(scipen=999)
rm(list = ls())
# Chunk 3: data
#| label: data
load(url("https://github.com/educacion-meritocracia/edumer-data/raw/main/output/data/edumer_students_long.RData"))
load(url("https://github.com/educacion-meritocracia/edumer-data/raw/main/output/data/db_proc_parents.RData"))
db_long <- edumer_students_long
rm(edumer_students_long)
glimpse(db_long)
# Chunk 4: select
#| label: select
db_long <- db_long %>%
select(id_estudiante,
ola,
consent = consentimiento,
curse_level = nivel_estudiante,
perc_effort = p1_1,
perc_talent = p1_2,
perc_rich_parents = p1_3,
perc_contact = p1_4,
pref_effort = p1_5,
pref_talent = p1_6,
pref_rich_parents = p1_7,
pref_contact = p1_8,
school_effort = p2_1,
school_talent = p2_2,
inequality = p9_1,
just_educ = p9_3,
just_health = p9_4,
just_pension = p9_5,
gender = p20,
age = p21_ano,
educ_m = p26,
educ_p = p27,
books = p30)
# Chunk 5: filter
#| label: filter
db_long <- db_long %>% filter(consent == 1) %>% select(-consent)
# Chunk 6: recode and transform
#| label: recode and transform
# level
frq(db_long$curse_level)
db_long <- db_long %>%
mutate(
cohort_level = if_else(curse_level %in% c("6to", "7mo"), "Básica", "Media"),
cohort_level = factor(cohort_level,
labels = c("Básica", "Media")),
curse_level = factor(curse_level,
levels = c("6to", "7mo", "1ro", "2do"))
)
# merit-scale society
frq(db_long$perc_effort)
frq(db_long$perc_talent)
frq(db_long$perc_rich_parents)
frq(db_long$perc_contact)
frq(db_long$pref_effort)
frq(db_long$pref_talent)
frq(db_long$pref_rich_parents)
frq(db_long$pref_contact)
labels1 <- c("Muy en desacuerdo" = 1,
"En desacuerdo" = 2,
"De acuerdo" = 3,
"Muy de acuerdo" = 4,
"No sabe" = 88,
"No responde" = 99)
db_long <- db_long %>%
mutate_at(.vars = (4:11),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (4:11),.funs = ~ set_na(., na = c(88,99)))
# merit school
frq(db_long$school_effort)
frq(db_long$school_talent)
db_long <- db_long %>%
mutate_at(.vars = (12:13),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (12:13),.funs = ~ set_na(., na = c(88,99)))
# percep inequality
frq(db_long$inequality)
db_long <- db_long %>%
mutate(inequality = sjlabelled::set_labels(inequality, labels = labels1),
inequality = set_na(inequality, na = c(88,99)))
# market justice preference
frq(db_long$just_educ)
frq(db_long$just_health)
frq(db_long$just_pension)
db_long <- db_long %>%
mutate_at(.vars = (15:17),.funs = ~ sjlabelled::set_labels(., labels = labels1))
db_long <- db_long %>%
mutate_at(.vars = (15:17),.funs = ~ set_na(., na = c(88,99)))
db_long$mjp <- rowMeans(x = db_long[15:17], na.rm = T)
db_long$mjp <- if_else(is.nan(db_long$mjp), NA, db_long$mjp)
summary(db_long$mjp)
# gender
frq(db_long$gender)
db_long$gender <- car::recode(db_long$gender,
recodes = c("'H'= 'Hombre'; 'M' = 'Mujer'; 'O' = 'Otro'"),
as.factor = T)
# age
frq(db_long$age)
db_long$age <- 2024 - db_long$age
db_long$age2 <- db_long$age^2
# ses
frq(db_long$books)
db_long <- db_long %>%
mutate(books = case_when(books <= 2 ~ "Menos de 25",
books >= 3 & books <= 6 ~ "Más de 25",
TRUE ~ NA_character_),
books = factor(books, levels = c("Menos de 25", "Más de 25")))
db_long <- left_join(
db_long,
db_parents[,c("id_estudiante_apoderado", "id_apoderado", "p12_1_apoderado")],
by = c("id_estudiante" = "id_estudiante_apoderado")
)
frq(db_long$p12_1_apoderado)
frq(db_long$educ_m)
frq(db_long$educ_p)
db_long <- db_long %>%
mutate(
across(
.cols = c(educ_m, educ_p, p12_1_apoderado),
.fns = ~ set_na(., na = c(88,99))
)
)
db_long <- db_long %>%
rowwise() %>%
mutate(
aux1 = case_when(
!is.na(educ_p) & !is.na(educ_m) ~ max(educ_p, educ_m),
is.na(educ_p)   & !is.na(educ_m) ~ educ_m,
!is.na(educ_p)  &  is.na(educ_m) ~ educ_p,
TRUE                                  ~ NA_real_
)
) %>%
ungroup()
frq(db_long$aux1)
frq(db_long$p12_1_apoderado)
db_long <- db_long %>%
group_by(id_estudiante) %>%
rowwise() %>%
mutate(parental_educ = if_else(is.na(p12_1_apoderado), aux1, p12_1_apoderado)) %>%
ungroup()
frq(db_long$parental_educ)
db_long <- db_long %>%
rowwise() %>%
mutate(parental_educ = case_when(parental_educ == 1 ~ "Primaria o menos",
parental_educ == 2 ~ "Primaria o menos",
parental_educ == 3 ~ "Primaria o menos",
parental_educ == 4 ~ "Secundaria",
parental_educ == 5 ~ "Secundaria",
parental_educ == 6 ~ "Superior técnica",
parental_educ == 7 ~ "Superior técnica",
parental_educ == 8 ~ "Universitaria o Posgrado",
parental_educ == 9 ~ "Universitaria o Posgrado",
parental_educ == 10 ~ "Universitaria o Posgrado",
is.na(parental_educ) ~ "Valor perdido")) %>%
ungroup()
db_long$parental_educ <- factor(db_long$parental_educ, levels = c("Primaria o menos", "Secundaria", "Superior técnica", "Universitaria o Posgrado", "Valor perdido"))
# Chunk 7: etiquetas
#| label: etiquetas
db_long$curse_level <- set_label(db_long$curse_level,label = "Curso estudiante")
db_long$cohort_level <- set_label(db_long$cohort_level,label = "Cohorte estudiante")
db_long$gender <- set_label(db_long$gender,label = "Género")
db_long$age <- set_label(db_long$age,label = "Edad")
db_long$age2 <- set_label(db_long$age2,label = "Edad^2")
db_long$books <- set_label(db_long$books,label = "Libros en el hogar")
db_long$mjp <- set_label(db_long$mjp,label = "Justicia de mercado")
db_long$parental_educ <- set_label(db_long$parental_educ,label = "Nivel educacional parental")
db_proc <- db_long %>%
select(-c(educ_m, educ_p, aux1, p12_1_apoderado, id_apoderado))
# Chunk 8: missings
#| label: missings
colSums(is.na(db_proc))
n_miss(db_proc)
prop_miss(db_proc)*100
miss_var_summary(db_proc)
vis_miss(db_proc) + theme(axis.text.x = element_text(angle=80))
# Chunk 9
print(summarytools::dfSummary(db_proc), method="render")
# Chunk 10
save(db_proc, file = here("output/data/db_proc.RData"))
#| label: libraries
if (! require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse,
sjmisc,
lme4,
easystats,
influence.ME,
broom.mixed,
here,
marginaleffects,
texreg,
ggdist,
misty,
kableExtra,
ggalluvial,
shadowtext,
MetBrewer)
options(scipen=999)
rm(list = ls())
load(file = here("output/data/db_proc.RData"))
print(summarytools::dfSummary(db_proc), method="render")
glimpse(db_proc)
m0 <- lmer(mjp ~ 1 + (1 | id_estudiante),
data = db_proc)
summary(m0)
performance::icc(m0, by_group = T)
0.443*100
sigma(m0)^2
VarCorr(m0)$id_estudiante[[1]]
sigma_e <- sigma(m0)^2
tau_mu <- VarCorr(m0)$id_estudiante[[1]]
cic <- tau_mu / (tau_mu+sigma_e)
cic
performance::icc(m0, by_group = T)
library(plm)
library(plmr)
plm::plm(formula = mjp ~ inequality, data = db_proc,
model = "within")
plm::plm(formula = mjp ~ inequality, data = db_proc,
model = "within") %>% summary()
plm::plm(formula = mjp ~ inequality, data = db_proc,
model = "within", effect = "twoways") %>% summary()
names(db_proc)
mean(db_long$inequality, use="complete.obs")
mean(db_proc$inequality, use="complete.obs")
db_proc$inequality
mean(db_proc$inequality, use="complete.obs")
mean(db_proc$inequality, na.rm = T)
#Gran media
db_proc$gm_inequality <- mean(db_proc$inequality, na.rm = T)
db_proc$gm_perc_effort <- mean(db_proc$perc_effort, na.rm = T)
db_proc$gm_perc_talent <- mean(db_proc$perc_talent, na.rm = T)
db_proc$gm_inequality
db_proc$gm_perc_effort
db_proc$gm_perc_talent
db_proc$inequality_cgm <- db_proc$inequality - db_proc$gm_inequality
db_proc$perc_effortr_cgm <- db_proc$perc_effort - db_proc$gm_perc_effort
db_proc$perc_talent_cgm <- db_proc$perc_talent - db_proc$gm_perc_talent
lmer(mjp ~ 1 + inequality_cgm + perc_effortr_cgm + gm_perc_talent +
(1 | id_estudiante), data = db_proc)
lmer(mjp ~ 1 + inequality_cgm + perc_effortr_cgm + gm_perc_talent +
(1 | id_estudiante), data = db_proc) %>% summary()
lmer(mjp ~ 1 + inequality_cgm + perc_effortr_cgm + perc_talent_cgm +
(1 | id_estudiante), data = db_proc) %>% summary()
lmer(mjp ~ 1 + inequality_cgm + perc_effortr_cgm + perc_talent_cgm +
(1 | id_estudiante), data = db_proc) %>% screenreg()
plm(mjp ~ inequality, data = db_proc, model = "within")
plm(mjp ~ inequality, data = db_proc, model = "within") %>% summary()
plm(mjp ~ inequality, data = db_proc, model = "within") %>% screenreg()
db_proc$perc_effort_cgm <- db_proc$perc_effort - db_proc$gm_perc_effort
lmer(mjp ~ 1 + inequality_cgm + perc_effort_cgm + perc_talent_cgm +
(1 | id_estudiante), data = db_proc) %>% screenreg()
db_proc %>%
group_by(id_estudiante) %>%
mutate(cm_inequality = mean(inequality, na.rm = T))
db_proc <- db_proc %>%
group_by(id_estudiante) %>%
mutate(cm_inequality = mean(inequality, na.rm = T)) %>%
ungroup()
db_proc %>%
group_by(id_estudiante) %>%
mutate(inequality_mean = mean(inequality, na.rm = T),
inequality_cwc = inequality - inequality_mean)
db_proc %>%
group_by(id_estudiante) %>%
mutate(inequality_mean = mean(inequality, na.rm = T),
inequality_cwc = inequality - inequality_mean) %>%
select(id_estudiante, inequality_mean, inequality, inequality_cwc)
2-2.5
db_proc <- db_proc %>%
group_by(id_estudiante) %>%
mutate(inequality_mean = mean(inequality, na.rm = T),
inequality_cwc = inequality - inequality_mean) %>%
ungroup()
lmer(mjp ~ 1 + inequality_cwc +
(1 | id_estudiante), data = db_proc) %>% screenreg()
plm(mjp ~ 1 + inequality_cwc, data = db_proc, model = "within")
# Chunk 1: set
#| label: set
#| echo: false
#| message: false
#| warning: false
library(knitr)
knitr::opts_chunk$set(echo = TRUE, include = TRUE, warning = FALSE, message = FALSE)
table_format <- if(is_html_output()) {
"html"
} else if(is_latex_output()) {
"latex"
}
table_format2 <- if(is_html_output()) {
T
} else if(is_latex_output()) {
F
}
options(kableExtra.html.bsTable = T)
options(knitr.kable.NA = "")
# Chunk 2: libraries
#| label: libraries
if (! require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse,
sjmisc,
lme4,
easystats,
influence.ME,
broom.mixed,
here,
marginaleffects,
texreg,
ggdist,
misty,
kableExtra,
ggalluvial,
shadowtext,
MetBrewer)
options(scipen=999)
rm(list = ls())
# Chunk 3: data
#| label: data
load(file = here("output/data/db_proc.RData"))
glimpse(db_proc)
glimpse(db_proc)
print(summarytools::dfSummary(db_proc), method="render")
m0 <- lmer(mjp ~ 1 + (1 | id_estudiante),
data = db_proc)
summary(m0)
performance::icc(m0, by_group = T)
db_proc <- db_proc %>%
group_by(id_estudiante) %>%
mutate(inequality_mean = mean(inequality, na.rm = T),
inequality_cwc = inequality - inequality_mean) %>%
ungroup()
lmer(mjp ~ 1 + inequality_cwc +
(1 | id_estudiante), data = db_proc) %>% screenreg()
plm(mjp ~ 1 + inequality_cwc, data = db_proc, model = "within")
library(plm)
plm(mjp ~ 1 + inequality_cwc, data = db_proc, model = "within")
names(db_proc)
